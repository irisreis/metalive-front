<body>
    <div class="container">
        <div class="header">
            <div class="logo-section">
                <div class="logo">METALIVE</div>
                <div class="breadcrumb">Dashboard / Vis√£o Geral</div>
            </div>
            <div class="user-section">
                <div class="user-info">
                    <!-- getInitials(clienteData?.nome) ainda usa ?. porque est√° fora do ng-container principal -->
                    <div class="avatar">{{ getInitials(clienteData?.nome) }}</div>
                    <div class="user-details">
                        <h3>{{ clienteData?.nome || 'Nome do Cliente' }}</h3>
                        <div class="plan-badge">{{ clienteData?.plano || 'PLANO B√ÅSICO' }} {{ clienteData?.statusPlano || 'ATIVO' }}</div>
                    </div>
                </div>
                <button class="logout-btn" (click)="onLogout()">Sair</button>
            </div>
        </div>

        <div class="nav-container">
            <div class="nav-tabs">
                <button class="nav-tab" [class.active]="currentContent === 'overview'" (click)="showContent('overview')">Vis√£o Geral</button>
                <button class="nav-tab" [class.active]="currentContent === 'nutritionist'" (click)="showContent('nutritionist')">Nutricionista</button>
                <button class="nav-tab" [class.active]="currentContent === 'personalTrainer'" (click)="showContent('personalTrainer')">Personal Trainer</button>
                <button class="nav-tab" [class.active]="currentContent === 'academy'" (click)="showContent('academy')">Academia</button>
                <button class="nav-tab" [class.active]="currentContent === 'chat'" (click)="showContent('chat')">Chat</button>
                <button class="nav-tab" [class.active]="currentContent === 'reports'" (click)="showContent('reports')">Relat√≥rios</button>
                <button class="nav-tab" [class.active]="currentContent === 'settings'" (click)="showContent('settings')">Configura√ß√µes</button>
            </div>
        </div>

        <div *ngIf="isLoading" class="loading-message">
            <p>Carregando dados do cliente...</p>
            <div class="spinner"></div>
        </div>

        <!-- CORRE√á√ÉO PRINCIPAL AQUI: *ngIf="clienteData as cliente" -->
        <ng-container *ngIf="!isLoading && clienteData as cliente">
            <div class="dashboard-grid" *ngIf="currentContent === 'overview'">

                <!-- NOVO FORMUL√ÅRIO CARD -->
                <div class="premium-card">
                    <div class="card-header">
                        <div class="card-info">
                            <div class="card-icon form-icon">üìù</div>
                            <div class="card-content">
                                <h3>Formul√°rio de Sa√∫de</h3>
                                <div class="card-subtitle">Mantenha seus dados atualizados</div>
                            </div>
                        </div>
                        <div class="status-indicator" [class.status-active]="!!cliente.formularioPreenchido" [class.status-pending]="!cliente.formularioPreenchido"></div>
                    </div>
                    <div class="card-stats">
                        <div class="stat-item">
                            <div class="stat-number">{{ cliente.formularioPreenchido ? 'Preenchido' : 'Pendente' }}</div>
                            <div class="stat-label">Status</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">{{ cliente.ultimaAtualizacaoFormulario || 'N/A' }}</div>
                            <div class="stat-label">√öltima Atualiza√ß√£o</div>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <ng-container *ngIf="!cliente.formularioPreenchido; else formFilled">
                            <button class="primary-btn" [routerLink]="['/formulario', clienteId]">Preencher Formul√°rio</button>
                        </ng-container>
                        <ng-template #formFilled>
                            <button class="secondary-btn" [routerLink]="['/formulario', clienteId]">Preencher Novamente</button>
                        </ng-template>
                    </div>
                </div>
                <!-- FIM DO NOVO FORMUL√ÅRIO CARD -->
                <div class="premium-card">
                    <div class="card-header">
                        <div class="card-info">
                            <div class="card-icon consultations-icon">üìÖ</div>
                            <div class="card-content">
                                <h3>Pr√≥ximas Consultas</h3>
                                <div class="card-subtitle">Agendamentos e compromissos</div>
                            </div>
                        </div>
                        <div class="status-indicator" [class.status-pending]="(cliente.proximasConsultas?.length || 0) === 0" [class.status-active]="(cliente.proximasConsultas?.length || 0) > 0"></div>
                    </div>
                    <div class="card-stats">
                        <div class="stat-item">
                            <div class="stat-number">{{ cliente.proximasConsultas?.length || 0 }}</div>
                            <div class="stat-label">Agendadas</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">3</div>
                            <div class="stat-label">Este M√™s</div>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button class="primary-btn" (click)="scheduleConsultation()">Agendar Nova Consulta</button>
                        <button class="secondary-btn" (click)="viewHistory('consultations')">Ver Hist√≥rico</button>
                    </div>
                </div>

                <div class="premium-card">
                    <div class="card-header">
                        <div class="card-info">
                            <div class="card-icon nutrition-icon">ü•ó</div>
                            <div class="card-content">
                                <h3>Plano Nutricional</h3>
                                <div class="card-subtitle">Dieta personalizada e acompanhamento</div>
                            </div>
                        </div>
                        <div class="status-indicator" [class.status-active]="!!cliente.diet" [class.status-pending]="!cliente.diet"></div>
                    </div>
                    <div class="card-stats">
                        <div class="stat-item">
                            <div class="stat-number">{{ cliente.aderenciaDieta || 'N/A' }}{{ cliente.aderenciaDieta ? '%' : '' }}</div>
                            <div class="stat-label">Ader√™ncia</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">{{ cliente.pesoPerdidoMes || '0' }}kg</div>
                            <div class="stat-label">Este M√™s</div>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button class="primary-btn" (click)="openNutritionPlan()">Acessar Plano</button>
                        <button class="secondary-btn" (click)="viewReports('nutrition')">Relat√≥rio Nutricional</button>
                    </div>
                </div>

                <div class="premium-card">
                    <div class="card-header">
                        <div class="card-info">
                            <div class="card-icon personal-icon">üí™</div>
                            <div class="card-content">
                                <h3>Personal Trainer</h3>
                                <div class="card-subtitle">Treinos e acompanhamento f√≠sico</div>
                            </div>
                        </div>
                        <div class="status-indicator" [class.status-active]="!!cliente.treino" [class.status-pending]="!cliente.treino"></div>
                    </div>
                    <div class="card-stats">
                        <div class="stat-item">
                            <div class="stat-number">{{ cliente.treinosRealizados || '0' }}</div>
                            <div class="stat-label">Treinos</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">{{ cliente.frequenciaTreino || '0x' }}</div>
                            <div class="stat-label">Semana</div>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button class="primary-btn" (click)="openWorkout()">Treino de Hoje</button>
                        <button class="secondary-btn" (click)="viewReports('personal')">Evolu√ß√£o F√≠sica</button>
                    </div>
                </div>

                <div class="premium-card">
                    <div class="card-header">
                        <div class="card-info">
                            <div class="card-icon history-icon">üìä</div>
                            <div class="card-content">
                                <h3>An√°lise de Performance</h3>
                                <div class="card-subtitle">M√©tricas e relat√≥rios detalhados</div>
                            </div>
                        </div>
                        <div class="status-indicator" [class.status-active]="(cliente.progressoGeral || 0) > 0" [class.status-pending]="(cliente.progressoGeral || 0) === 0"></div>
                    </div>
                    <div class="card-stats">
                        <div class="stat-item">
                            <div class="stat-number">{{ cliente.progressoGeral || '0' }}%</div>
                            <div class="stat-label">Progresso</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">{{ cliente.avaliacaoGeral || 'N/A' }}</div>
                            <div class="stat-label">Avalia√ß√£o</div>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button class="primary-btn" (click)="viewAnalytics()">Relat√≥rio Completo</button>
                        <button class="secondary-btn" (click)="exportData()">Exportar Dados</button>
                    </div>
                </div>
            </div>

            <div class="analytics-section" *ngIf="currentContent === 'overview'">
                <div class="analytics-header">
                    <div class="analytics-title">Performance Analytics</div>
                    <div class="analytics-subtitle">Acompanhe seu progresso e conquistas em tempo real</div>
                </div>
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-number">{{ cliente.diasAtivos || '0' }}</div>
                        <div class="metric-label">Dias Ativos</div>
                        <div class="metric-change">{{ cliente.diasAtivosChange || '0%' }} vs. m√™s anterior</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-number">{{ cliente.pesoAtual || '0.0' }}kg</div>
                        <div class="metric-label">Peso Atual</div>
                        <div class="metric-change">{{ cliente.pesoDesdeInicio || '0.0' }}kg desde in√≠cio</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-number">{{ cliente.caloriasDia || '0' }}</div>
                        <div class="metric-label">Calorias/Dia</div>
                        <div class="metric-change">Meta: {{ cliente.metaCalorias || '0' }} cal</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-number">{{ cliente.taxaSucesso || '0' }}%</div>
                        <div class="metric-label">Taxa de Sucesso</div>
                        <div class="metric-change">{{ cliente.taxaSucessoChange || '0%' }} vs. m√™s anterior</div>
                    </div>
                </div>
            </div>

            <div *ngIf="currentContent === 'nutritionist'">
                <!-- Agora 'cliente.diet' √© seguro -->
                <ng-container *ngIf="cliente.diet; else noDietNutritionist">
                    <div class="main-content">
                        <div class="diet-content">
                            <div class="profissional-card">
                                <div class="profissional-header">
                                    <div class="profissional-avatar">üë©‚Äç‚öïÔ∏è</div>
                                    <div class="profissional-info">
                                        <h2>Profissional: Amanda Santana</h2>
                                        <p>Nutricionista Cl√≠nica Especializada</p>
                                        <div class="consultation-info">
                                            <strong>Detalhes do Atendimento:</strong> Atendimento via Google Meet ap√≥s o preenchimento do formul√°rio.
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="service-section">
                                <div class="service-header">
                                    <div class="service-title">
                                        <div class="service-icon">üçΩÔ∏è</div>
                                        <h2>Plano de Dieta Semanal</h2>
                                    </div>
                                    <!-- CORRE√á√ÉO: Use downloadDietPDF() para o cliente -->
                                    <!-- <button class="download-btn" (click)="downloadDietPDF()" *ngIf="cliente.pdfUrl">
                                        <span>üì•</span>
                                        Baixar PDF
                                    </button> -->
                                </div>
                                <pre class="dietaTreinoPronto">{{ cliente.diet }}</pre>
                            </div>
                        </div>

                        <div class="sidebar">
                            <div class="stats-card">
                                <div class="stats-header">
                                    <div class="stats-title">Progresso Nutricional</div>
                                    <div class="stats-subtitle">Semana atual</div>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Meta Cal√≥rica</span>
                                    <span class="stat-value">{{ cliente.metaCaloriasNutricional || '0' }} cal</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Consumidas</span>
                                    <span class="stat-value">{{ cliente.caloriasConsumidas || '0' }} cal</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Ader√™ncia</span>
                                    <span class="stat-value">{{ cliente.aderenciaNutricional || '0' }}%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" [style.width.%]="cliente.aderenciaNutricional || 0"></div>
                                </div>
                            </div>

                            <div class="stats-card">
                                <div class="stats-header">
                                    <div class="stats-title">A√ß√µes R√°pidas</div>
                                    <div class="stats-subtitle">Gerencie seu plano</div>
                                </div>
                                <div class="action-buttons">
                                    <button class="primary-btn" (click)="scheduleConsultation()">Agendar Consulta</button>
                                    <button class="secondary-btn" (click)="viewNutritionHistory()">Hist√≥rico Nutricional</button>
                                    <button class="secondary-btn" (click)="updateProgress()">Atualizar Progresso</button>
                                </div>
                            </div>

                            <div class="stats-card">
                                <div class="stats-header">
                                    <div class="stats-title">Dica da Semana</div>
                                    <div class="stats-subtitle">Amanda Santana</div>
                                </div>
                                <p style="color: #4a5568; font-size: 14px; line-height: 1.5;">
                                    "Lembre-se de manter-se hidratada! Beba pelo menos 2 litros de √°gua por dia e inclua ch√°s naturais sem a√ß√∫car em sua rotina."
                                </p>
                            </div>
                        </div>
                    </div>
                </ng-container>
                <ng-template #noDietNutritionist>
                    <div class="informacoesProfissional">
                        <p class="textoNaoDisponivel">Nenhuma dieta dispon√≠vel. Clique <a [routerLink]="['/formulario', clienteId]">aqui</a> para responder um formul√°rio e agendar uma consulta.</p>
                    </div>
                </ng-template>
            </div>


            <div *ngIf="currentContent === 'personalTrainer'">
                <!-- CORRE√á√ÉO: Use *ngIf="clienteData as cliente" aqui tamb√©m para este bloco -->
                <ng-container *ngIf="clienteData?.treino; else noWorkoutPersonal">
                    <div class="main-content">
                        <div class="workout-content">
                            <div class="profissional-card">
                                <div class="profissional-header">
                                    <div class="profissional-avatar">üë®‚Äç</div>
                                    <div class="profissional-info">
                                        <h2>Profissional: Maicon Salles</h2>
                                        <p>Personal Trainer Especializado</p>
                                        <div class="consultation-info">
                                            <strong>Detalhes do Atendimento:</strong> Atendimento via Google Meet ap√≥s o preenchimento do formul√°rio.
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="service-section">
                                <div class="service-header">
                                    <div class="service-title">
                                        <div class="service-icon">üèãÔ∏è‚Äç‚ôÄÔ∏è</div>
                                        <h2>Plano de Treino Semanal</h2>
                                    </div>
                                    <!-- CORRE√á√ÉO: Use downloadWorkoutPDF() para o cliente -->
                                    <!-- <button class="download-btn" (click)="downloadWorkoutPDF()" *ngIf="cliente.treinoPdfUrl">
                                        <span>üì•</span>
                                        Baixar PDF
                                    </button> -->
                                </div>

                                <pre class="dietaTreinoPronto">{{ cliente.treino }}</pre>
                            </div>
                        </div>

                        <div class="sidebar">
                            <div class="stats-card">
                                <div class="stats-header">
                                    <div class="stats-title">Progresso de Treino</div>
                                    <div class="stats-subtitle">Semana atual</div>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Treinos Conclu√≠dos</span>
                                    <span class="stat-value">{{ cliente.treinosSemanaConcluidos || '0' }}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Sess√µes Restantes</span>
                                    <span class="stat-value">{{ cliente.sessoesRestantes || '0' }}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Ader√™ncia</span>
                                    <span class="stat-value">{{ cliente.treinoAderencia || '0' }}%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" [style.width.%]="cliente.treinoAderencia || 0"></div>
                                </div>
                            </div>

                            <div class="stats-card">
                                <div class="stats-header">
                                    <div class="stats-title">A√ß√µes R√°pidas</div>
                                    <div class="stats-subtitle">Gerencie seu treino</div>
                                </div>
                                <div class="action-buttons">
                                    <button class="primary-btn" (click)="scheduleConsultation()">Agendar Sess√£o</button>
                                    <button class="secondary-btn" (click)="viewPersonalHistory()">Hist√≥rico de Treinos</button>
                                    <button class="secondary-btn" (click)="updateWorkoutProgress()">Atualizar Progresso</button>
                                </div>
                            </div>

                            <div class="stats-card">
                                <div class="stats-header">
                                    <div class="stats-title">Dica da Semana</div>
                                    <div class="stats-subtitle">Maicon Salles</div>
                                </div>
                                <p style="color: #4a5568; font-size: 14px; line-height: 1.5;">
                                    "Consist√™ncia √© a chave! Mantenha seus treinos em dia e garanta um bom aquecimento para evitar les√µes."
                                </p>
                            </div>
                        </div>
                    </div>
                </ng-container>
                <ng-template #noWorkoutPersonal>
                    <div class="informacoesProfissional">
                        <p class="textoNaoDisponivel">Nenhum treino dispon√≠vel. Clique <a [routerLink]="['/formulario', clienteId]">aqui</a> para responder um formul√°rio e agendar uma consulta.</p>
                    </div>
                </ng-template>
            </div>

            <div *ngIf="currentContent === 'chat'">
                <div class="informacoesProfissional">
                    <p class="tituloConsulta">CHAT DE SUPORTE</p>
                    <p class="textoNaoDisponivel">Funcionalidade de chat em desenvolvimento. Em breve voc√™ poder√° conversar com nossa equipe de suporte e profissionais por aqui! Aguarde por novidades!</p>
                </div>
            </div>

            <div *ngIf="currentContent === 'academy'">
                <div class="informacoesProfissional">
                    <p class="tituloConsulta">ACADEMIA</p>
                    <p class="textoNaoDisponivel">Informa√ß√µes sobre a academia e agendamento de aulas em breve.</p>
                </div>
            </div>
            <div *ngIf="currentContent === 'reports'">
                <div class="informacoesProfissional">
                    <p class="tituloConsulta">RELAT√ìRIOS</p>
                    <p class="textoNaoDisponivel">Aqui voc√™ poder√° ver relat√≥rios detalhados do seu progresso.</p>
                </div>
            </div>
            <div *ngIf="currentContent === 'settings'">
                <div class="informacoesProfissional">
                    <p class="tituloConsulta">CONFIGURA√á√ïES</p>
                    <p class="textoNaoDisponivel">Gerencie suas prefer√™ncias e informa√ß√µes de perfil aqui.</p>
                </div>
            </div>
        </ng-container>

        <div *ngIf="!isLoading && !clienteData" class="no-data-message">
            <p>Nenhum dado do cliente encontrado. Por favor, tente novamente mais tarde ou entre em contato com o suporte.</p>
        </div>
    </div>
</body>